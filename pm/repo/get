#!/bin/execlineb
elgetopt "c:dhk:t:"
multisubstitute {
	importas -uD "0" ELGETOPT_c ELGETOPT_c
	importas -uD "0" ELGETOPT_d ELGETOPT_d
	importas -uD "0" ELGETOPT_h ELGETOPT_h
	importas -uD "0" ELGETOPT_k ELGETOPT_k
	importas -uD "0" ELGETOPT_t ELGETOPT_t
}
elgetpositionals
emptyenv -Po
backtick -Ex file {
	backtick -Ex dir {
		pipeline { echo $0 }
		awk -F "/" "{for (i = 1; i < NF - 1; i++) printf \"%s/\", $i; print \"repo\"}"
	}
	cd $dir
	getcwd PWD
	multisubstitute {
		elglob -s repositories "*"
		importas -iu PWD PWD
	}
	forx -Ex 0 repo { $repositories }
	if { test -e "${repo}/${1}" }
	echo ${PWD}/${repo}/${1}
}
if { test -n "${file}" }
ifelse -n { test "0" = "${ELGETOPT_c}" } {
	backtick -Ex dir { dirname $file }
	venus-conf $ELGETOPT_c ${dir}/repo.conf
}
ifelse -n { test "0" = "${ELGETOPT_d}" } {
	dirname $file
}
ifelse -n { test "0" = "${ELGETOPT_h}" } {
	backtick dir { dirname $file }
	backtick version { venus-conf version $file }
	multisubstitute {
		importas -iu dir dir
		importas -iu version version
	}
	venus-conf ${1}#${version}.pkg ${dir}/chksum
}
ifelse -n { test "0" = "${ELGETOPT_k}" } {
	venus-conf ${ELGETOPT_k} $file
}
ifelse -n { test "0" = "${ELGETOPT_t}" } {
	foreground { venus-conf -t ${ELGETOPT_t} $file }
}
echo $file
